- if @report.report_data[:competency360_competencies_decending]  
  - sorted_competency_scores = @report.report_data[:competency_scores].sort_by{|key,value| value[:score][:points].to_i }.reverse
  = render partial: "shared/360/mrf_report_header.pdf.haml"
  .scores
    .scores_competencies_graph.descending_order.border-bottom-grayLighter
      .divider2
      .blue_heading.large-text
        360&#176; Competencies: Scores in Descending Order
      .divider1
      .graph_instructions
        .graph_stakeholder_rating_icon.pull-left
        .pull-left.bold
          360&#176; Rating
        .graph_classic_user_icon.span
        .pull-left.bold
          Self Rating
        
        .clr

      .traits_under_graph
        .graph_container
          .left_sec.pull-left
            .graph_instructions{style:"margin-left:175px"}
              .span1.divider2.graph_stakeholder_rating_icon
              .span1.divider2.graph_classic_user_icon.first
              .clr
            %ul
              - sorted_competency_scores.each do |competency, competency_score|
                %li
                  .span5.first.trait_title
                    = truncate competency, length: 30
                    
                  .stakeholder_rating.pull-left
                    = competency_score[:score][:points] || "-"
                  .self_rating.span
                    = competency_score[:average_score_self][:points] || "-"
                  .clr
                
          .right_sec.span12.pull-right
            .classic_competency_graph
              .classic_competency_graph_scale
                .block.pull-left
                - @competency_graph_buckets.each do |competency_graph_bucket|
                  .block.pull-left{:style=>"width: #{830/(@competency_graph_buckets.size)}px; text-align: center"}
                    = competency_graph_bucket.name

                .clr
              .graph
                .graph_content
                  - old_min = @competency_graph_buckets.first.min_val
                  - old_max = @competency_graph_buckets.last.max_val
                  - sorted_competency_scores.each_with_index do |(competency, competency_score), index|
                    - if competency_score[:score][:points]
                      - percent_360 = convertToRange(old_min, old_max, 0, 100, competency_score[:score][:points])
                      - percent_360 = percent_360 == 0 ? 2 : percent_360
                    - else
                      - percent_360 = 0
                    - if competency_score[:average_score_self][:points]
                      - percent_self = convertToRange(old_min, old_max, 0, 100, competency_score[:average_score_self][:points])
                      - percent_self = percent_self == 0 ? 2 : percent_self
                    - else
                      - percent_self = 0
                    - if index > 0
                      .divider1  
                    .descending_graph_bar.max{:style => "width: #{percent_360}%; background: #a119a6; margin-top:10px"}
                    .descending_graph_bar.min{:style => "width: #{percent_self}%; background: #24d8ba"}
          .clr
= render :partial => "mrf/assessments/reports/competency_report/pdf/competencies_traits_descending_order"
.page-break
