- content_for :jquery do
  = javascript_include_tag "jquery"
  = javascript_include_tag "jquery_ujs"

.create-test.norms
  .inn.first
    .page-title 
      %b Test Title: 
      #{@assessment.name}
  .inn
    = render :partial => "shared/test-flow-sub-nav"
    .divider1
    .medium-text
      .span.first
        %b Functional Area: 
      .span4
        #{@assessment.functional_area.name}
      .span.left-offset1
        %b Industry:  
      .span4
        #{@assessment.industry.name}
      .span.left-offset1
        %b Experience Level: 
      .span4
        #{@assessment.job_experience.display_text}
    .clr
    .divider1
      
    = form_for @assessment, :as => :assessment, :url => norms_company_assessment_path(:company_id => params[:company_id], :id => params[:id]), multipart: true, method: :put do |f|
      %input{type: 'hidden', name: 'assessment[industry_id]', value: @assessment.industry_id}
      %input{type: 'hidden', name: 'assessment[functional_area_id]', value: @assessment.functional_area_id}
      %input{type: 'hidden', name: 'assessment[job_experience_id]', value: @assessment.job_experience_id}
      .action
        .pull-left
          %b{ :style => "font-size:14px;" } Please select the behavioral factors that you would like to measure:
        %button.pull-right.btn.btn-info
          Proceed
        .clr
      .factors
        - aindex = 0
        - @factor_norms_by_fit.each do |fit,norms|
          .titles.clearfix
            .span14.first.large-text
              Factors for #{fit.name}
            .pull-right
              .span6
                Desired/Acceptable Score Range 
              .span2
                Critical
          .divider1
          %ul.unstyled.factor-snippet
            - norms[:factors].each_with_index do |assessment_factor_norm,index|
              - aindex = aindex + 1
              = render :partial => 'assessment_factor_norm_fields', :locals => { :assessment_factor_norm => assessment_factor_norm, :index => aindex }
            - norms[:alarm_factors].each_with_index do |assessment_factor_norm,index|
              - aindex = aindex + 1
              = render :partial => 'assessment_alarm_factor_norm_fields', :locals => { :assessment_factor_norm => assessment_factor_norm, :index => aindex }    
      .divider2
      %button.pull-right.btn.btn-info
        Proceed
      .clr
      .divider1

%script{type: 'text/javascript'} 
  jQuery(document).ready(function($){
  $("input[name='selected_factor']").change(function(){
  var index = $(this).attr("index");
  if($(this).is(":checked")){
  $("input:not(:checkbox)[index='"+index+"']").removeAttr("disabled");
  $("select[index='"+index+"']").removeAttr("disabled");
  $("#critical_checkbox_"+index).removeAttr("disabled");
  $("#li_"+index).addClass("checked");
  }else{
  var id = $("#id_"+index).val();
  if(id != null && id != ""){
  $("#destroy_"+index).val(true);
  }else{
  $("input:not(:checkbox)[index='"+index+"']").attr("disabled",'disabled');
  $("select[index='"+index+"']").attr("disabled",'disabled');
  $("#critical_checkbox_"+index).attr("disabled",'disabled');
  $("#li_"+index).removeClass("checked");
  }
  }
  });
  $("input[name='checkbox_critical']").change(function(){
  var index = $(this).attr("index");
  if($(this).is(":checked")){
  $("#critical_"+index).val("on");
  }else{
  $("#critical_"+index).val("off");
  }
  });
  });    
