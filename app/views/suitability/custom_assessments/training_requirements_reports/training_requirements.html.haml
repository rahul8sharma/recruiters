- content_for :stylesheets do
  = stylesheet_link_tag "training_requirements_report"  

.create-test.creat-test-show
  .page-title.pull-left
    .divider1
    Test #{@assessment.id} - #{@assessment.name}
  %a.btn.btn-warning.pull-right.big-text.big.span{ href: add_candidates_company_custom_assessment_path(:company_id => params[:company_id], :id => params[:id]) }
    Send This Test
  - if !@assessment.report_types.include?(Vger::Resources::Suitability::CustomAssessment::ReportType::TRAINING_REQUIREMENT)
    %a.extra-medium-text.pull-right.line-height3{:href => enable_training_requirements_report_company_custom_assessment_path(:company_id => params[:company_id], :id => params[:id]), :title => "Enable Training Requirements Report for this test"}
      Enable Training Requirements Report
  - else
    - if @assessment_report && @assessment_report.status == Vger::Resources::Suitability::AssessmentReport::Status::UPLOADED
      %a.extra-medium-text.pull-right.line-height3{:href => download_training_requirements_report_company_custom_assessment_path(:company_id => params[:company_id], :id => params[:id], :format => :pdf), :title => "Download Training Requirements Report as PDF", target: "_blank"}
        Download a PDF version of Training Requirements Report    
  .clr
  .divider2
  .clr
  = render :partial => "shared/candidate-content-sub-nav"
  .padding-all2.border-warning.shifted-up1
    - if @assessment.report_types.include?(Vger::Resources::Suitability::CustomAssessment::ReportType::TRAINING_REQUIREMENT)
      - if @assessment_report && @assessment_report.report_data.present?
        .summary.padding-all1.clearfix
          .span
            %b.show.pull-left 
              Industry: 
            .span6
              = @assessment.industry.name rescue '-'
          .span
            %b.show.pull-left 
              Functional Area: 
            .span6
              = @assessment.functional_area.name rescue '-'
          .span
            %b.show.span
              Experience Level: 
            .span 
              = @assessment.job_experience.display_text rescue '-'
        .divider1
        .pull-left.medium-text
          Results last updated: #{htime @assessment_report.updated_at} Hrs, #{hdate @assessment_report.updated_at}
        .pull-right.text-right
          %b.medium-text Sent: 
          %b.large-text #{@company.assessmentwise_statistics[:sent][@assessment.id.to_s] rescue 0}
          %span.left-offset1
            %b.medium-text Taken: 
            %b.large-text #{@company.assessmentwise_statistics[:completed][@assessment.id.to_s] rescue 0}
        .clr.divider1
        - factor_scores = @assessment_report.report_data[:factor_scores]
        - factor_scores = Hash[factor_scores.keys[0..9].map{|key| [key,factor_scores[key]] }]
        .training_requirements_report
          = render :partial => "shared/reports/training_requirements/h_graph", locals: { factor_scores: factor_scores }
          .divider1  
          = render :partial => "shared/reports/training_requirements/factor_scores", :locals => { :factor_scores => factor_scores }
          .divider3
      - else
        .alert-info.alert
          - sent = @company.assessmentwise_statistics[:sent][@assessment.id.to_s] rescue 0
          %span{ class: "medium-text", style: "color: black;" }
            - if sent == 0
              Training Requirements are enabled for this assessment. Page will be updated on sufficient responses.
            - else
              %i.icon-spinner.icon-spin
              Training Requirements calculation is in progress.
    - else
      .alert-info.alert
        %span{ class: "medium-text", style: "color: black;" }
          Training Requirements calculation hasn't been enabled for this test. Please use the button above or to enable it 
          %a{:href => enable_training_requirements_report_company_custom_assessment_path(:company_id => params[:company_id], :id => params[:id]), :title => "Edit Test"}
            click here 
