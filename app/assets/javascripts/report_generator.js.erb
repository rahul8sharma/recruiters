//= require ajax

$(document).ready(function(){
  function failure(response){
    console.log(response);
  }
  function renderCompetencies(response) {
    for (var i = 0; i < response.competencies.length; i++) {
      var competency = response.competencies[i].attributes;
      if(competency.name == undefined){
        console.log(response.competencies[i]);
      }
      $("#competencies .competency-list").clear();
      var id = "assessment[competency]["+i+"]["+competency.id+"]";
      $("#competencies .competency-list").append("<li>"+
        "<input type='checkbox' value="+competency.id+" id="+id+" name = "+id+">"
         +"<label for="+id+">"+ competency.name + "</label></li>");
    }
    $("#competencies").show();
  }

  function renderFunctionalTraits(response){
   for (var i = 0; i < response.traits.length; i++) {
      var trait = response.traits[i].attributes;
      if(trait.name == undefined){
        console.log(response.traits[i]);
      }
      $("#functional_traits .functional-trait-list").clear();
      var id = "assessment[functional_traits]["+i+"]["+trait.id+"]";
      $("#functional_traits .functional-trait-list").append("<li>"+
        "<input type='checkbox' value="+trait.id+" id="+id+" name = "+id+">"
         +"<label for="+id+">"+ trait.name + "</label></li>");
    }
    $("#functional_traits").show();

  }

  function buildCompetencies(company_id){
    jsonRequest("/suitability/competencies/get_competencies",{company_ids: company_id},renderCompetencies,failure)
  }

  function buildFunctionalTraits(company_id){
   jsonRequest("/functional/traits/get_traits",{company_ids: company_id},renderFunctionalTraits,failure)
  }

  $("#report_assessment_new").on("click",function(){
    $("#existing-assessment").hide();
    $("#new-assessment").show();
  });

  $("#report_assessment_existing").on("click",function(){
    $("#new-assessment").hide();
    $("#existing-assessment").show();
  });

  $("#assessment_assessment_type").on("change",function(){
    var company_id = $("#assessment_company_id").val();
    if(company_id == "") {
      alert ("Please enter a company ID");
    }
    else{
      buildCompetencies(company_id);
      buildFunctionalTraits(company_id);
    }
  });


});